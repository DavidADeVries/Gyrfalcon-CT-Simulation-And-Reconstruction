<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">value</span>, <span class="var type1" id="S3T2U4">isRejected</span>] = interpolateFrameForIndex(<span class="var type1" id="S4T1U7">x</span>, <span class="var type1" id="S5T1U8">y</span>, <span class="var type1" id="S6T3U9">targetLocationInM</span>, <span class="var type1" id="S7T3U10">targetPixelDimsInM</span>, <span class="var type1" id="S8T4U11">frame</span>, <span class="var type1" id="S9T5U12">rayRejectionMap</span>, <span class="var type1" id="S10T3U13">detectorPixelDimsInM</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%function [value, isRejected] = interpolateFrameForIndex(x, y, targetLocationInM, targetPixelDimsInM, frame, rayRejectionMap, detectorPixelDimsInM)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T1:U10"><span class="var type1" id="S11T1U16">xLeft</span> = <span class="mxinfo " id="T1:U12"><span class="mxinfo " id="T1:U13"><span class="var type1" id="S6T3U19">targetLocationInM</span>(<span class="mxinfo " id="T1:U15">1</span>)</span> + <span class="mxinfo " id="T1:U16">(<span class="mxinfo " id="T1:U17"><span class="var type1" id="S4T1U24">x</span>-<span class="mxinfo " id="T1:U19">1</span></span>)*<span class="mxinfo " id="T1:U20"><span class="var type1" id="S7T3U27">targetPixelDimsInM</span>(<span class="mxinfo " id="T1:U22">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T1:U23"><span class="var type1" id="S12T1U31">xRight</span> = <span class="mxinfo " id="T1:U25"><span class="mxinfo " id="T1:U26"><span class="var type1" id="S6T3U34">targetLocationInM</span>(<span class="mxinfo " id="T1:U28">1</span>)</span> + <span class="mxinfo " id="T1:U29">(<span class="var type1" id="S4T1U38">x</span>)*<span class="mxinfo " id="T1:U31"><span class="var type1" id="S7T3U40">targetPixelDimsInM</span>(<span class="mxinfo " id="T1:U33">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo " id="T1:U34"><span class="var type1" id="S13T1U44">yTop</span> = <span class="mxinfo " id="T1:U36"><span class="mxinfo " id="T1:U37"><span class="var type1" id="S6T3U47">targetLocationInM</span>(<span class="mxinfo " id="T1:U39">2</span>)</span> + <span class="mxinfo " id="T1:U40">(<span class="var type1" id="S5T1U51">y</span>)*<span class="mxinfo " id="T1:U42"><span class="var type1" id="S7T3U53">targetPixelDimsInM</span>(<span class="mxinfo " id="T1:U44">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T1:U45"><span class="var type1" id="S14T1U57">yBottom</span> = <span class="mxinfo " id="T1:U47"><span class="mxinfo " id="T1:U48"><span class="var type1" id="S6T3U60">targetLocationInM</span>(<span class="mxinfo " id="T1:U50">2</span>)</span> + <span class="mxinfo " id="T1:U51">(<span class="mxinfo " id="T1:U52"><span class="var type1" id="S5T1U65">y</span>-<span class="mxinfo " id="T1:U54">1</span></span>)*<span class="mxinfo " id="T1:U55"><span class="var type1" id="S7T3U68">targetPixelDimsInM</span>(<span class="mxinfo " id="T1:U57">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T3:U58"><span class="var type1" id="S15T3U72">xIndices</span> = <span class="mxinfo " id="T3:U60"><span class="mxinfo " id="T1:U61"><span class="mxinfo " id="T1:U62">floor(<span class="mxinfo " id="T1:U63"><span class="var type1" id="S11T1U79">xLeft</span> / <span class="mxinfo " id="T1:U65"><span class="var type1" id="S10T3U81">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U67">1</span>)</span></span>)</span>+<span class="mxinfo " id="T1:U68">1</span></span> : 1 : <span class="mxinfo " id="T1:U69"><span class="mxinfo " id="T1:U70">floor(<span class="mxinfo " id="T1:U71"><span class="var type1" id="S12T1U89">xRight</span> / <span class="mxinfo " id="T1:U73"><span class="var type1" id="S10T3U91">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U75">1</span>)</span></span>)</span>+<span class="mxinfo " id="T1:U76">1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T3:U77"><span class="var type1" id="S17T3U96">yIndices</span> = <span class="mxinfo " id="T3:U79"><span class="mxinfo " id="T1:U80"><span class="mxinfo " id="T1:U81">floor(<span class="mxinfo " id="T1:U82"><span class="var type1" id="S14T1U103">yBottom</span> / <span class="mxinfo " id="T1:U84"><span class="var type1" id="S10T3U105">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U86">2</span>)</span></span>)</span>+<span class="mxinfo " id="T1:U87">1</span></span> : 1 : <span class="mxinfo " id="T1:U88"><span class="mxinfo " id="T1:U89">floor(<span class="mxinfo " id="T1:U90"><span class="var type1" id="S13T1U113">yTop</span> / <span class="mxinfo " id="T1:U92"><span class="var type1" id="S10T3U115">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U94">2</span>)</span></span>)</span>+<span class="mxinfo " id="T1:U95">1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo " id="T3:U96"><span class="var type1" id="S18T3U120">xSideLengths</span> = <span class="mxinfo " id="T3:U98"><span class="mxinfo " id="T3:U99">ones(<span class="mxinfo " id="T1:U100">1</span>,<span class="mxinfo " id="T1:U101">length(<span class="var type1" id="S15T3U127">xIndices</span>)</span>)</span>*<span class="mxinfo " id="T1:U103"><span class="var type1" id="S10T3U129">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U105">1</span>)</span></span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T3:U106"><span class="var type1" id="S21T3U133">ySideLengths</span> = <span class="mxinfo " id="T3:U108"><span class="mxinfo " id="T3:U109">ones(<span class="mxinfo " id="T1:U110">1</span>,<span class="mxinfo " id="T1:U111">length(<span class="var type1" id="S17T3U140">yIndices</span>)</span>)</span>*<span class="mxinfo " id="T1:U113"><span class="var type1" id="S10T3U142">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U115">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T1:U116"><span class="mxinfo " id="T1:U117"><span class="var type1" id="S18T3U147">xSideLengths</span>(<span class="mxinfo " id="T1:U119">1</span>)</span> = <span class="mxinfo " id="T1:U120"><span class="mxinfo " id="T1:U121"><span class="var type1" id="S18T3U151">xSideLengths</span>(<span class="mxinfo " id="T1:U123">1</span>)</span> - (<span class="mxinfo " id="T1:U124"><span class="var type1" id="S11T1U155">xLeft</span> - <span class="mxinfo " id="T1:U126">(<span class="mxinfo " id="T1:U127"><span class="mxinfo " id="T1:U128"><span class="var type1" id="S15T3U160">xIndices</span>(<span class="mxinfo " id="T1:U130">1</span>)</span>-<span class="mxinfo " id="T1:U131">1</span></span>)*<span class="mxinfo " id="T1:U132"><span class="var type1" id="S10T3U164">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U134">1</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T1:U135"><span class="mxinfo " id="T1:U136"><span class="var type1" id="S18T3U169">xSideLengths</span>(<span class="mxinfo " id="T1:U138">end</span>)</span> = <span class="mxinfo " id="T1:U139"><span class="mxinfo " id="T1:U140"><span class="var type1" id="S18T3U174">xSideLengths</span>(<span class="mxinfo " id="T1:U142">end</span>)</span> - (<span class="mxinfo " id="T1:U143">(<span class="mxinfo " id="T1:U144"><span class="mxinfo " id="T1:U145"><span class="var type1" id="S15T3U182">xIndices</span>(<span class="mxinfo " id="T1:U147">end</span>)</span>*<span class="mxinfo " id="T1:U148"><span class="var type1" id="S10T3U186">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U150">1</span>)</span></span>) - <span class="var type1" id="S12T1U188">xRight</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T1:U152"><span class="mxinfo " id="T1:U153"><span class="var type1" id="S21T3U192">ySideLengths</span>(<span class="mxinfo " id="T1:U155">1</span>)</span> = <span class="mxinfo " id="T1:U156"><span class="mxinfo " id="T1:U157"><span class="var type1" id="S21T3U196">ySideLengths</span>(<span class="mxinfo " id="T1:U159">1</span>)</span> - (<span class="mxinfo " id="T1:U160"><span class="var type1" id="S14T1U200">yBottom</span> - <span class="mxinfo " id="T1:U162">(<span class="mxinfo " id="T1:U163"><span class="mxinfo " id="T1:U164"><span class="var type1" id="S17T3U205">yIndices</span>(<span class="mxinfo " id="T1:U166">1</span>)</span>-<span class="mxinfo " id="T1:U167">1</span></span>)*<span class="mxinfo " id="T1:U168"><span class="var type1" id="S10T3U209">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U170">2</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T1:U171"><span class="mxinfo " id="T1:U172"><span class="var type1" id="S21T3U214">ySideLengths</span>(<span class="mxinfo " id="T1:U174">end</span>)</span> = <span class="mxinfo " id="T1:U175"><span class="mxinfo " id="T1:U176"><span class="var type1" id="S21T3U219">ySideLengths</span>(<span class="mxinfo " id="T1:U178">end</span>)</span> - (<span class="mxinfo " id="T1:U179">(<span class="mxinfo " id="T1:U180"><span class="mxinfo " id="T1:U181"><span class="var type1" id="S17T3U227">yIndices</span>(<span class="mxinfo " id="T1:U183">end</span>)</span>*<span class="mxinfo " id="T1:U184"><span class="var type1" id="S10T3U231">detectorPixelDimsInM</span>(<span class="mxinfo " id="T1:U186">2</span>)</span></span>) - <span class="var type1" id="S13T1U233">yTop</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    [<span class="var type1" id="S23T4U237">xSide</span>,<span class="var type1" id="S24T4U238">ySide</span>] = meshgrid(<span class="var type1" id="S18T3U241">xSideLengths</span>, <span class="var type1" id="S21T3U242">ySideLengths</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T4:U192"><span class="var type1" id="S26T4U245">areas</span> = <span class="mxinfo " id="T4:U194"><span class="var type1" id="S23T4U247">xSide</span> .* <span class="var type1" id="S24T4U248">ySide</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">    [<span class="var type1" id="S27T4U252">colIndex</span>,<span class="var type1" id="S28T4U253">rowIndex</span>] = meshgrid(<span class="var type1" id="S15T3U256">xIndices</span>, <span class="var type1" id="S17T3U257">yIndices</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T4:U201"><span class="var type1" id="S29T4U260">frameIndices</span> = <span class="mxinfo " id="T4:U203">sub2ind(<span class="mxinfo " id="T6:U204">size(<span class="var type1" id="S8T4U265">frame</span>)</span>, <span class="var type1" id="S28T4U266">rowIndex</span>, <span class="var type1" id="S27T4U267">colIndex</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo " id="T4:U208"><span class="var type1" id="S32T4U270">pixelVals</span> = <span class="mxinfo " id="T4:U210"><span class="var type1" id="S8T4U272">frame</span>(<span class="var type1" id="S29T4U273">frameIndices</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo " id="T5:U213"><span class="var type1" id="S33T5U276">rayRejectVals</span> = <span class="mxinfo " id="T5:U215"><span class="var type1" id="S9T5U278">rayRejectionMap</span>(<span class="var type1" id="S29T4U279">frameIndices</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T2:U218"><span class="var type1" id="S3T2U282">isRejected</span> = <span class="mxinfo " id="T2:U220">all(<span class="mxinfo " id="T7:U221">all(<span class="var type1" id="S33T5U287">rayRejectVals</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T4:U223"><span class="var type1" id="S26T4U290">areas</span> = <span class="mxinfo " id="T4:U225"><span class="var type1" id="S26T4U292">areas</span> .* (<span class="mxinfo " id="T5:U227">~<span class="var type1" id="S33T5U295">rayRejectVals</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T1:U229"><span class="var type1" id="S35T1U298">totalArea</span> = <span class="mxinfo " id="T1:U231">sum(<span class="mxinfo " id="T3:U232">sum(<span class="var type1" id="S26T4U303">areas</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T4:U234"><span class="var type1" id="S37T4U306">areasNorm</span> = <span class="mxinfo " id="T4:U236"><span class="var type1" id="S26T4U308">areas</span> ./ <span class="var type1" id="S35T1U309">totalArea</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo " id="T4:U239"><span class="var type1" id="S38T4U312">weightedPixelVals</span> = <span class="mxinfo " id="T4:U241"><span class="var type1" id="S32T4U314">pixelVals</span> .* <span class="var type1" id="S37T4U315">areasNorm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T1:U244"><span class="var type1" id="S2T1U318">value</span> = <span class="mxinfo " id="T1:U246">sum(<span class="mxinfo " id="T3:U247">sum(<span class="var type1" id="S38T4U323">weightedPixelVals</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
